{% extends 'base.html' %}
{% block content %}
<h2>Nueva Factura</h2>
<form method="post" id="factura-form">
    {% csrf_token %}
    <div class="mb-3">
        <label>Cliente</label>
        <select name="cliente" class="form-control" required>
            {% for c in clientes %}
                <option value="{{ c.id }}">{{ c.nombre }}{% if c.email %} ({{ c.email }}){% endif %}</option>
            {% endfor %}
        </select>
    </div>

    {{ factura_form.enviar_email }}

    <h4>Productos</h4>
    <div id="productos-container">
        <div class="producto-item mb-2">
            <select name="producto_id" class="form-control d-inline w-50" required>
                {% for p in productos %}
                    <option value="{{ p.id }}">{{ p.nombre }} - ${{ p.precio }}</option>
                {% endfor %}
            </select>
            <input type="number" name="cantidad" class="form-control d-inline w-25" value="1" min="1" required>
            <button type="button" class="btn btn-danger btn-sm" onclick="removeProducto(this)">â€“</button>
        </div>
    </div>
    <button type="button" class="btn btn-secondary" onclick="addProducto()">+ Agregar producto</button>
    <br><br>
    <button type="submit" class="btn btn-primary">Crear Factura</button>
</form>

<script>
function addProducto() {
    const container = document.getElementById('productos-container');
    const newItem = container.firstElementChild.cloneNode(true);
    newItem.querySelector('input').value = 1;
    container.appendChild(newItem);
}
function removeProducto(btn) {
    if (document.querySelectorAll('.producto-item').length > 1) {
        btn.closest('.producto-item').remove();
    }
}
</script>
{% endblock %}